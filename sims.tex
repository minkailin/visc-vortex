\section{Numerical experiments}
The neccessary condition for the RWI --- a potential vorticity 
extremum --- is either set as an initial condition via a density bump, 
or obtained from a smooth disc by evolving it under the action of a
radially-structured viscosity profile or disc-planet interaction. The
setup of each experiment is detailed in subsequent sections.   

We adopt units such that $G=M_*=1$, and the reference radius $r_0=1$.    
We set $\sigma=0.5$ for the initial surface density profile and apply 
frictional damping within the shells $r<r_\mathrm{d,in} = 1.25\rin$
and $r>r_\mathrm{d,out}=0.84\rout$ with damping rate $\hat{\gamma}=1$. 

The fluid equations are evolved using the \pluto code \citep{mignone07} with 
the FARGO algorithm enabled\citep{mignone12}. We employ a static
spherical grid with $(N_r, N_\theta, N_\phi)$ zones uniformly spaced
in all directions. For the present simulations the code was configured
with piece-wise linear reconstruction, a Roe solver and second order
Runge-Kutta time integration.   

Boundary conditions are imposed through ghost zones.   
Let the flow velocity parallel and normal to a boundary be
$v_\parallel$ and $v_\perp$, respectively. ($v_\perp>0$ signifies flow
out of the computational domain.) Two types of numerical 
conditions are considered for the meridional boundaries:
\begin{inparaenum}[(a)]
\item \emph{reflective}: $\rho$ and $v_\parallel$ are symmetric with
  respect to the boundary while $v_\perp$ is anti-symmetric;  
  %% \item \emph{outflow}, ghost values of $\rho,\,v_\parallel$ set to that of the nearest active zone, 
  %% likewise for $v_\perp$ but only if the active $v_\perp>0$, otherwise ghost values of $v_\perp$ are set to zero; 
\item \emph{unperturbed}: ghost zones retain their initial values
\end{inparaenum}.
The boundary conditions adopted for all simulations is unperturbed in
$r$, reflective in $\theta$ and periodic in $\phi$. 

%For all cases both radial boundaries are unperturbed and the midplane is reflective. 

\subsection{Diagnostics}
We list several quantities calculated from
simulation data for use in visualization and analysis. 
Averaged quantities are used to facilitate  
comparison between different cases. We use $\avg{\cdots}_j$ 
to denote spatial averaging along the $j^\mathrm{th}$ co-ordinate. 
Azimuthal averages are taken over $\phi\in[0,2\pi]$, while the domain
for meridional averaging is stated along with simulation results in
the next section. %% We also use $\overline{\cdots}$ to denote a further
%% time average. 

\subsubsection{Density perturbations}
The relative density perturbation $\delta\rho$ is 
\begin{align}
  \delta\rho(\bm{r},t) \equiv \frac{\rho - \rho_i}{\rho_i}, 
\end{align}
and non-axisymmetric density fluctuation is 
\begin{align}
  \Delta\rho(\bm{r},t) \equiv \frac{\rho - \aziavg{\rho}}{\aziavg{\rho}}.
\end{align}
%where $\avg{\cdot}_\phi$ denotes an azimuthal average. 
Note that in general $\Delta\rho$ accounts for the time evolution of
the axisymmetric part of the density field, but if
$\p_t\avg{\rho}_\phi=0$ then $\Delta\rho$ is  identical to
$\delta\rho-\avg{\delta\rho}_\phi$.   

For quantitative analysis of non-axisymmetric density structures, we  
compute the $m^\mathrm{th}$ Fourier component of the density field, 
\begin{align}
\hat{\rho}_m(r,\theta,t) \equiv \int_0^{2\pi} \rho(\bm{r},t)\exp{(-\ii m\phi)}d\phi.
\end{align}
The magnitude of a Fourier mode is measured by 
\begin{align} 
a_m(t)\equiv \frac{b_m(t)}{b_0(0)},\quad b_m(t)\equiv \avg{|\hat{\rho}_m|}_r,
\end{align} 


The complex frequency $\sigma_m$ associated with the $m^\mathrm{th}$ component 
is defined through 
\begin{align}\label{sigma}
  \frac{\p\hat{\rho}_m}{\p t} \equiv -\ii\sigma_m\hat{\rho}_m. 
\end{align}
The time derivative in Eq. \ref{sigma} can be computed implicitly by 
Fourier-transforming the continuity equation.

Note that we have defined the complex frequency as one would in a
linear stability analysis because the RWI is a linear 
instability. %% This definition is useful in assessing how the linear is
%% affected by the various boundary effects in the
%% linear phase (i.e. when perturbations are small). 
The mode frequency defined here is therefore most appropriate to
describe simulations where the axisymmetric background does not evolve
in time (i.e. if $\p_t\avg{\rho}_\phi=0$), as required to define a
linear instability. 

In the linear stability problem $\sigma_m$ is a constant eigenvalue. 
However, when extracted numerically from a non-linear simulation, 
we will generally obtain $\sigma_m=\sigma_m(r,\theta,t)$. Thus, we compute 
$\avg{\sigma_m}_r = m\omega_m + \ii q_m$    
where $\omega_m$ is the mode frequency and $q_m$ is the growth rate.  


\subsubsection{Vortical structures}
The Rossby number
\begin{align}
  Ro \equiv \frac{\hat{\bm{z}}\cdot\nabla\times\bv-\avg{\hat{\bm{z}}\cdot\nabla\times\bv}_\phi}{2\aziavg{\Omega}},
\end{align}
can be used to quantify the strength of vortical structures and to visualize it. 
$Ro<0$ signifies anti-cyclonic motion with respect to the axisymmetric shear. Note that while
for thin discs the rotation profile is Keplerian, the shear is non-Keplerian for radially 
structured discs (i.e. $\Omega\simeq\Omega_K$ but $\kappa\neq\Omega$).


\subsubsection{Potential vorticity}
The potential vorticity (PV, or vortensity) is defined as
%\begin{align}
$  \bm{\eta}_\mathrm{3D} = \nabla\times\bm{v}/\rho. $
%\end{align}
%% Accordingly we defined the density-weighted average
%% \begin{align}
%%   \bm{\eta} = \frac{\int \rho\bm{\eta}_\mathrm{3D} dz}{\int\rho dz}. 
%% \end{align}
%% We are usually interested in the $z$-component of the PV, 
Since we are considering geometrically thin discs, however, it will be
convenient to work with vertically averaged quantities. Specifically,
we define 
\begin{align}
  \eta_z = \frac{1}{\Sigma}\int \hat{\bm{z}}\cdot\nabla\times\bv dz
\end{align}
as the PV in this paper, where $\Sigma = \int\rho dz$ and the
integrals are confined to the computational domain. 

We recall for a two-dimensional disc the vortensity is defined as 
$\eta_\mathrm{2D} \equiv \hat{\bm{z}}\cdot\nabla\times\bv/\Sigma$, and
extrema in $\eta_\mathrm{2D}$ is neccessary for the RWI in
2D. Clearly, if the velocity field has no vertical dependence then
$\eta_z$ is proportional to $\eta_\mathrm{2D}$ (at fixed cylindrical
radius).   

